<html i18n:domain="occams.studies" metal:use-macro="load:../master.pt">
  <metal:content-slot fill-slot="content-slot">

    <div style="display: none;" data-bind="visible: isReady">

      <header class="page-header">
        <div class="btn-toolbar pull-right">
          <button metal:use-macro="load: header-btn-form.pt" />
          <button metal:use-macro="load: header-btn-edit.pt" />
          <button metal:use-macro="load: header-btn-delete.pt" />
        </div>
        <h1>
          <span i18n:translate="">Visit</span>
          <span data-bind="text: visit.visit_date"></span>
        </h1>
        <ul metal:use-macro="load: header-details.pt" />
        <nav metal:use-macro="load: header-nav.pt" />

        <div metal:use-macro="load: ../form/modal-form-add.pt"></div>
        <div metal:use-macro="load: modal-visit-edit.pt"></div>
        <div metal:use-macro="load: modal-visit-delete.pt"></div>
      </header>

      <table class="table table-hover table-striped">
        <colgroup>
        </colgroup>
        <thead>
          <th><input type="checkbox" /></th>
          <th i18n:translate="">ID</th>
          <th i18n:translate="">Form</th>
          <th i18n:translate="">Collect Date</th>
          <th i18n:translate="">State</th>
          <th></th>
        </thead>
        <tbody data-bind="foreach: visit.entities">
          <td>
            <input type="checkbox"
                data-bind="
                  attr: {value: id},
                  click: $root.onClickForm" />
          </td>
          <td><code data-bind="text: id"></code></td>
          <td data-bind="text: schema.title"></td>
          <td data-bind="text: collect_date"></td>
          <td data-bind="text: state.title"></td>
          <td>
            <a data-bind="attr: {href: __url__}"><span class="fa fa-chevron-right"></span></a>
          </td>
        </tbody>
      </table>

      <!-- ko if: hasSelectedForms -->
        <div class="well well-sm">
          <span class="btn-group">
            <button class="btn btn-default" i18n:translate="">Move</button>
            <button class="btn btn-default" i18n:translate="">Delete</button>
          </span>
          <strong>
            <span data-bind="text: selectedForms().length"></span>
            <span i18n:translate="">Selected</span>
          </strong>
        </div>
      <!-- /ko -->

    </div> <!-- /:isReady -->


  </metal:content-slot>
  <metal:content-slot fill-slot="javascript-extras-slot">
    <script>
      $(function(){
        ko.applyBindings(new VisitView({
            visitData: JSON.parse($('#visit-data').text()),
            formsUrl: "${request.current_route_path(_route_name='visit_forms')}"
          }),
          document.getElementById('view-visit')
        );
      });
    </script>
    <tal:json define="json import:json">
      <script id="visit-data" type="application/json" >${json.dumps(visit)}</script>
    </tal:json>

  </metal:content-slot>
</html>
