<html i18n:domain="occams.studies" metal:use-macro="load: ../master.pt">
  <metal:content-slot fill-slot="content-slot">
    <header class="page-header">
      <h1 i18n:translate="">Exports</h1>
      <nav metal:use-macro="load: ./panels/nav.pt" />
    </header>

    <div style="display: none;" data-bind="visible: ready()">
      <div class="clearfix">
        <div class="btn-group pull-left">
          <button
              type="button"
              class="btn btn-default dropdown-toggle"
              data-toggle="dropdown"
              id="codebook-select">
            <span i18n:translate="" data-bind="ifnot:title()">Select a data file...</span>
            <span i18n:translate="" data-bind="if:title()">
              <span data-bind="text:title()"></span>
            </span>

            <span data-bind="visible:loading()">
              <img src="${request.static_path('occams.studies:static/images/spinner-small.png')}" />
            </span>

            <span class="caret"></span>
          </button>

          <ul class="dropdown-menu dropdown-scrollable"
              role="menu"
              aria-labelledby="exportable-select">
            <li role="presentation"
                tal:repeat="file exportables"
                data-bind="attr: {'class': name() == '${file.name}' ? 'active' : ''}">
              <a role="menuitem"
                  tabindex="-1"
                  href="#/${file.name}"
                  data-name="${file.name}"
                  data-title="${file.title}"
                  data-bind="click: function(){ $('#codebook-select').dropdown('toggle'); return true;}"
                  >${file.title}</a>
            </li>
          </ul>
        </div>
        <a class="btn btn-primary pull-right"
            href="${request.route_path('export_codebook_download')}"
            target="_blank">
          <span class="glyphicon glyphicon-book"></span>
          <span i18n:translate="">Download Entire Codebook</span>
        </a>
      </div>

    <br />

    <div id="export-codebook-table"
        class="table-responsive"
        data-bind="visible: !loading() && name()">
      <table class="table">
        <thead>
          <tr>
            <th class="field">Field</th>
            <th class="version">Version</th>
            <th class="question">Question</th>
            <th class="type">Type</th>
            <th class="is_required">
              <span class="glyphicon glyphicon-asterisk"
                  title="Required"
                  i18n:attributes="title"></span>
            </th>
            <th class="is_system">
              <span class="glyphicon glyphicon-wrench"
                  title="System"
                  i18n:attributes="title"></span>
            </th>
            <th class="is_private">
              <span class="glyphicon glyphicon-user"
                title="Private"
                i18n:attributes="title"></span>
            </th>
            <th class="is_collection">
              <span class="glyphicon glyphicon-list"
                title="Multiple Choice"
                i18n:attributes="title"></span>
            </th>
            <th class="codes">Codes</th>
          </tr>
        </thead>
        <tbody data-bind="foreach: rows()">
          <tr>
            <td class="field"><code data-bind="text: field"></code></td>
            <td class="version"><span data-bind="text: publish_date"></span></td>
            <td class="question">
              <strong data-bind="text: title"></strong><br />
              <span data-bind="text: description"></span>
            </td>
            <td class="type"><code data-bind="text: type"></code></td>
            <td class="is_required">
              <span data-bind="visible: is_required"
                  class="glyphicon glyphicon-asterisk"
                  title="Required"
                  i18n:translate="title"></span>
            </td>
            <td class="is_system">
              <span data-bind="visible: is_system"
                  class="glyphicon glyphicon-wrench"
                  title="System"
                  i18n:translate="title"></span>
            </td>
            <td class="is_private">
              <span data-bind="visible: is_private"
                  class="glyphicon glyphicon-user"
                  title="Private"
                  i18n:translate="title"></span>
            </td>
            <td class="is_collection">
                <span data-bind="visible: is_collection"
                    class="glyphicon glyphicon-list"
                    title="Multiple Choice"
                    i18n:translate="title"></span>
            </td>
            <td class="codes">
              <table data-bind="if: choices">
                <tbody data-bind="foreach: choices">
                  <tr>
                    <td class="code"><code data-bind="text: $data[0]"></code></td>
                    <td class="title"><span data-bind="text: $data[1]"></span></td>
                  </tr>
                </tbody>
              </table>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="well well-lg"
        i18n:translate=""
        data-bind="visible: !loading() && !name()">
      Nothing selected
    </div>
  </div>

  </metal:content-slot>
</html>
