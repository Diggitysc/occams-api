<html i18n:domain="occams.studies" metal:use-macro="load: ../master.pt">
  <metal:content-slot fill-slot="content-slot">
    <header class="page-header clearfix">
      <div class="btn-toolbar pull-right">
        <a href="#" class="btn btn-default"><span class="fa fa-user"></span> Add Patient</a>
        <a href="#" class="btn btn-default"><span class="fa fa-mortar-board"></span> Add Study</a>
      </div>
    </header>
    <div class="row">
      <div class="col-sm-4">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title" i18n:translate="">Recently Viewed Patients</h3>
          </div>
          <div class="panel-body" tal:condition="viewed_count <= 0">
            <p class="text-muted text-center" i18n:translate="">Nothing viewed recently</p>
          </div>
          <ul class="list-group" tal:condition="viewed_count > 0">
            <tal:patients tal:define="humanize import:humanize" repeat="patient viewed">
              <li class="list-group-item">
                <a href="${request.route_path('patient', patient=patient.pid)}">${patient.pid}</a>
                &bull;
                <small class="text-muted">
                  ${humanize.naturaltime(patient['view_date'])}
                </small>
              </li>
            </tal:patients>
          </ul>
        </div> <!-- .panel -->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title" i18n:translate="">Recently Modified Patients</h3>
          </div>
          <div class="panel-body" tal:condition="modified_count <= 0">
            <p class="text-muted text-center" i18n:translate="">Nothing viewed recently</p>
          </div>
          <ul class="list-group" tal:condition="modified > 0">
            <tal:patients tal:define="humanize import:humanize" repeat="patient modified">
              <li class="list-group-item">
                <a href="${request.route_path('patient', patient=patient.pid)}">${patient.pid}</a>
                &bull;
                <small class="text-muted">
                  ${humanize.naturaltime(patient.modify_date)}
                  <span i18n:translate="">by</span>
                  ${patient.modify_user.key}
                </small>
              </li>
            </tal:patients>
          </ul>
        </div> <!-- .panel -->
      </div> <!-- /.col-sm-4 -->
      <div class="col-sm-8">
        <div class="list-group">
          <a tal:repeat="study studies"
              href="${request.route_path('study', study=study.name)}"
              class="list-group-item">
            <h4 class="list-group-item-heading">
              ${study.title}
              <span class="fa fa-lock" tal:condition="study.is_locked"></span>
            </h4>
            <ul class="details list-inline">
              <li>
                <span class="text-muted" i18n:translate="">Code:</span>
                <code>${study.code}</code>
              </li>
              <li>
                <span class="text-muted" i18n:translate="">Label:</span>
                <span>${study.short_title}</span>
              </li>
              <tal:rand condition="study.is_randomized">
                <li>
                  <span class="text-muted" i18n:translate="">Randomized:</span>
                  <span tal:switch="bool(study.is_randomized)">
                    <span tal:case="True" tal:omit-tag="" i18n:translate="">Yes</span>
                    <span tal:case="False" tal:omit-tag="" i18n:translate="">No</span>
                  </span>
                </li>
                <li>
                  <span class="text-muted" i18n:translate="">Blinded:</span>
                  <span tal:switch="bool(study.is_blinded)">
                    <span tal:case="True" tal:omit-tag="" i18n:translate="">Yes</span>
                    <span tal:case="False" tal:omit-tag="" i18n:translate="">No</span>
                  </span>
                </li>
              </tal:rand>
              <li>
                <span class="text-muted" i18n:translate="">Consent:</span>
                <code>${study.consent_date}</code>
              </li>
              <li tal:condition="study.start_date">
                <span class="text-muted" i18n:translate="">Start:</span>
                <code>${study.start_date}</code>
              </li>
              <li tal:condition="study.stop_date">
                <span class="text-muted" i18n:translate="">End:</span>
                <code>${study.stop_date}</code>
              </li>
            </ul>
          </a>
        </div> <!-- /.list-group -->
      </div> <!-- /.col-sm-8 -->
    </div> <!-- /.row -->

  </metal:content-slot>
</html>
