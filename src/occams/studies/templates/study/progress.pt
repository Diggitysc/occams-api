<html i18n:domain="occams.studies" metal:use-macro="load: ../master.pt">
  <metal:content-slot fill-slot="content-slot">

    <header class="page-header">
      <div metal:use-macro="load: ./panels/view-toolbar.pt" />
      <h1 i18n:translate="">${study.title}</h1>
      <ul metal:use-macro="load: ./panels/details.pt" />
      <nav metal:use-macro="load: ./panels/nav.pt" />
    </header>

    <div class="alert alert-info" tal:condition="not:has_cycles" i18n:translate="">
      No cycle information has been added yet
    </div>

    <div class="table-responsive table-scrollable" tal:condition="has_cycles">
      <table class="table table-bordered table-striped">
        <thead>
          <tr>
            <th class="cycle" rowspan="2" i18n:translate="">Cycle</th>
            <th class="total" rowspan="2" i18n:translate="">Visits</th>
            <th colspan="${cycles_count}" i18n:translate="">Visits By eCRF State</th>
          </tr>
          <tr>
            <th tal:repeat="state states" class="state">${state.title}</th>
          </tr>
        </thead>
        <tbody>
          <tr tal:repeat="cycle cycles">
            <td class="cycle">
              <a href="${request.current_route_path(
                          _route_name='schedule_view',
                          cycle_name=cycle.Cycle.name)}">${cycle.Cycle.title}</a>
            </td>
            <td class="total">
              <span
                  tal:define="value cycle.visits_count"
                  tal:condition="value > 0"
                  tal:replace="value" />
            <tal:states repeat="column cycles.column_descriptions">
              <td tal:define="
                    index repeat['column'].index;
                    value cycle[index]"
                  tal:condition="index > 1">
                <span tal:condition="value > 0" tal:replace="value" ></span>
              </td>
            </tal:states>
          </tr>
        </tbody>
      </table>
    </div>

  </metal:content-slot>
</html>

