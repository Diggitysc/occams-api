<!DOCTYPE html>
<html
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:i18n="http://xml.zope.org/namespaces/i18n"
    xmlns:tal="http://xml.zope.org/namespaces/tal"
    xmlns:metal="http://xml.zope.org/namespaces/metal"
    xml:lang="en"
    lang="en"
    i18n:domain="occams.forms">

  <head>
    <meta charset="utf-8">
    <title>${request.settings.app_title|'OCCAMS Form'}</title>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link tal:repeat="url request.webassets_env['default-css'].urls()" href="${url}" rel="stylesheet" />
    <!--! Shortcut icons -->
    <link
        rel="shortcut icon"
        href="${request.static_path('occams.forms:static/images/favicon.ico')}"/>
    <link rel="shortcut icon" sizes="1024x1024" href="${request.static_path('occams.forms:static/images/favicon-highres.png')}" />
    <link rel="shortcut icon" sizes="128x128" href="${request.static_path('occams.forms:static/images/favicon.png')}" />
    <link rel="apple-touch-icon" sizes="128x128" href="${request.static_path('occams.forms:static/images/favicon.png')}" />
    <link rel="apple-touch-icon-precomposed" sizes="128x128" href="${request.static_path('occams.forms:static/images/favicon.png')}" />
  </head>

  <body
      data-view-name="${request.matched_route.name}"
      data-view-path="${request.current_route_path()}">

    <!--! Wrap the content so we can push the footer to the bottom of the page -->
    <div id="wrap">
      <!--! Keep the app navbar separate from the content container -->
      <nav
          class="navbar navbar-default navbar-static-top"
          role="navigation"
          i18n:domain="occams.forms">

        <div class="container">

          <div class="navbar-header">
            <button
                type="button"
                class="navbar-toggle"
                data-toggle="collapse"
                data-target=".navbar-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand"
                href="${request.route_path('home')}">OCCAMS Form</a>
            <a href="${request.route_path('home')}"
                class="navbar-logo">
              <img src="${request.static_path('occams.forms:static/images/orglogo.png')}"
                  alt="Organization Logo"/>
            </a>
          </div> <!--/.navbar-header -->

          <div class="collapse navbar-collapse">

            <ul class="nav navbar-nav"
                tal:define="section request.current_route_path()">
              <li tal:define="url request.route_path('home')"
                  tal:attributes="class python:'active' if url == section else ''"
                  tal:condition="request.has_permission('view')">
                <a href="${url}" i18n:translate="">Forms</a>
              </li>
              <li tal:define="url request.route_path('workflow_view', workflow='default')"
                  tal:attributes="class python:'active' if url == section else ''"
                  tal:condition="request.has_permission('view')">
                <a href="${url}" i18n:translate="">Workflows</a>
              </li>
            </ul>

            <ul class="nav navbar-nav navbar-right"
                tal:define="user request.environ['repoze.who.identity']['properties']|nothing;"
                  tal:condition="user">
              <li><p class="navbar-text">${user['first_name']}</p></li>
              <li class="dropdown"
                  tal:condition="request.apps">
                <a href="#apps"
                  role="button"
                  class="dropdown-toggle"
                  rel="tooltip"
                  data-toggle="dropdown"
                  data-placement="bottom"
                  data-container="body"
                  data-animation="false"
                  title="Services"
                  ><span class="glyphicon glyphicon-th"></span><span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu" aria-labelledby="Apps Menu">
                  <tal:suites repeat="suite request.apps">
                    <li role="presentation" class="dropdown-header">
                      ${suite['title']}
                    </li>
                    <tal:apps repeat="app suite['apps']">
                      <li role="presentation">
                        <a href="${app['url']}" role="menuitem">${app['title']}</a>
                      </li>
                    </tal:apps>
                    <li role="presentation" class="divider"
                        tal:condition="not:repeat.suite.end"></li>
                  </tal:suites>
                </ul>
              <li>
                <a href="${request.route_path('account_logout')}"
                    rel="tooltip"
                    data-placement="bottom"
                    data-container="body"
                    data-animation="false"
                    title="Log Out"
                  ><span class="glyphicon glyphicon-log-out"></span></a>
              </li>
            </ul>

          </div><!--/.nav-collapse -->

        </div>
      </nav>

      <div class="container">
        <main id="${request.matched_route.name}">
          <metal:content-slot define-slot="content-slot" />
        </main>
      </div> <!-- /.container -->
    </div> <!-- /#wrap -->

    <footer i18n:domain="occams.forms" id="footer">
      <div class="container">
        <p class="text-muted credit">
          Version <span tal:define="pkg import:occams.studies">${pkg.__version__}</span>.
          Developed by <a href="http://cfar.ucsd.edu/bit">UCSD Bit Core</a>.
        </p>
      </div>
    </footer>

    <!--! Load scripts at the end so we don't block rendering -->
    <script
        tal:repeat="url request.webassets_env['default-js'].urls()"
        src="${url}"
        type="text/javascript"> </script>

    <script id="modal-form-template" type="text/html">
      <div class="modal fade" data-keyboard="false" data-bind="showModal: $data">
        <div class="modal-dialog">
          <div class="modal-content">
            <form data-bind="attr: {method: method, action: action}, submit: onSubmit">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" data-bind="text: title"></h4>
              </div>
              <div class="modal-body" data-bind="foreach: fields()">
                <div class="form-group" data-bind="css: {'has-error': errors().length}">
                  <!-- ko if: input_type() != 'hidden' -->
                    <label data-bind="css: {required: required()}, text: label()"></label>
                    <p class="help-block" data-bind="text: description()"></p>
                  <!-- /ko -->
                  <!-- ko foreach: errors() -->
                    <p class="help-block"><strong data-bind="text: $data"></strong></p>
                  <!-- /ko -->
                  <div data-bind="html: input()"></div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-link" data-dismiss="modal" data-bind="text: cancel()"></button>
                <button type="submit" class="btn btn-primary" data-bind="text: submit()"></button>
              </div>
            </form>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->
    </script>

  </body>
</html>
