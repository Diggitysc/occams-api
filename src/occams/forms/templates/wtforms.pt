<!--  Reusable WTFORMS field template macros

      WTFORMS only renders the HTML widget portion of a field
      (e.g. <input>, <textarea>), leaving the rest of the markup up to
      the developer, these macros try to standardize a general look and feel
      using Boostrap for all types of fields.

      Please note that these are not required for rendering a WTFORM form.
      If you want a highligh customized form UI, you should probably do so
      in the respective view's markup.
-->
<metal:wtforms tal:condition="False">

  <!--! Renders all fields in a form

        Parameters:
          form - The wtform.Form instance
    -->
  <metal:macro define-macro="fields">
    <metal:fields tal:repeat="field form" use-macro="macros.field" />
  </metal:macro>

  <!--! Renders an individual field based on its field type.

        Parameters:
          field - The wtform.Field instance
    -->
  <metal:macro define-macro="field">
    <tal:switch switch="field.type">
      <tal:case case="string:CSRFTokenField" metal:use-macro="macros.widget" />
      <tal:case case="string:HiddenField" metal:use-macro="macros.widget" />
      <tal:case case="string:FormField" metal:use-macro="macros.fieldset" />
      <tal:case case="default" metal:use-macro="macros.default" />
    </tal:switch>
  </metal:macro>

  <!--! Renders a field set and its fields

        Parameters:
          field - The wtform.FormField instance
    -->
  <metal:macro define-macro="fieldset">
    <fieldset>
      <legend tal:define="label field.label.text|nothing" tal:condition="label">${label}</legend>
      <p class="lead" tal:condition="field.description|nothing">${field.description}</p>
      <metal:fields tal:define="form field.form" use-macro="macros.fields" />
    </fieldset>
  </metal:macro>


  <!--! Default form field component rendering

        Renders a field wrapped in Bootstrap markup

        Optionally, its "field" slot may be overrriden to provde manual control
        of how the HTML widget should be rendered.

        Parameters:
          field - The wtform.field instance
    -->
  <metal:macro define-macro="default">
    <div class="form-group ${'has-error' if field.errors else ''}"
        data-bind="css: {'has-error': ${field.short_name}.hasErrors}">
      ${structure: field.label(class_='required' if field.flags.required else '')}
      <p class="help-block" tal:condition="field.description|nothing">${field.description}</p>
      <!-- ko foreach: ${field.short_name}.errors -->
        <p class="help-block"><strong data-bind="text: $data"></strong></p>
      <!-- /ko -->
      <!--! Define a "widget" slot so the developer can override with custom markup -->
      <metal:widget define-slot="widget">
        <input  metal:use-macro="macros.widget" />
      </metal:widget>
    </div>
  </metal:macro>

  <!--! Renders a standalone HTML widget

        Parameters:
          field - The wtform.field instance
    -->
  <metal:macro define-macro="widget">
    <tal:widget define="
          widget_cls    type(field.widget).__name__;
          option_cls    type(field.option_widget).__name__ if hasattr(field, 'option_widget') else None;
          name          field.short_name;
          ">
      <tal:switch switch="option_cls">
        <tal:case case="string:RadioInput">
          <tal:fields define="this_field field" repeat="field this_field" metal:use-macro="macros.widget">
        </tal:case>
        <tal:case case="string:CheckboxInput">
          <tal:fields define="this_field field" repeat="field this_field" metal:use-macro="macros.widget">
        </tal:case>
        <tal:case case="default">
          <tal:switch switch="widget_cls">
            <tal:case case="string:RadioInput" define="ko string:value:$name, disable:$name.disabled">
              <div class="radio">
                <label>
                  ${structure: field(**{'data-bind': ko})}
                  ${structure: field.label.text}
                </label>
              </div>
            </tal:case>
            <tal:case case="string:CheckboxInput" define="ko string:value:$name, disable:$name.disabled">
              <div class="checkbox">
                <label>
                  ${structure: field(**{'data-bind': ko})}
                  ${structure: field.label.text}
                </label>
              </div>
            </tal:case>
            <tal:case case="string:Date" define="ko string:value:$name, disable:$name.disabled">
              ${structure: field(class_='form-control', **{'data-bind': ko})}
            </tal:case>
            <tal:case case="string:Date" define="ko string:value:$name, disable:$name.disabled">
              ${structure: field(class_='form-control', **{'data-bind': ko})}
            </tal:case>
            <tal:case case="string:Select" define="ko string:value:$name, disable:$name.disabled, select2:{}">
              ${structure: field(class_='form-control', **{'data-bind': ko})}
            </tal:case>
            <tal:case case="string:TelInput" define="ko string:value:$name, disable:$name.disabled">
              ${structure: field(class_='form-control', **{'data-bind': ko})}
            </tal:case>
            <tal:case case="string:EmailInput" define="ko string:value:$name, disable:$name.disabled">
              ${structure: field(class_='form-control', **{'data-bind': ko})}
            </tal:case>
            <tal:case case="string:NumberInput" define="ko string:value:$name, disable:$name.disabled">
              ${structure: field(class_='form-control', rows=5, **{'data-bind': ko})}
            </tal:case>
            <tal:case case="string:TextArea" define="ko string:value:$name, disable:$name.disabled">
              ${structure: field(class_='form-control', rows=5, **{'data-bind': ko})}
            </tal:case>
            <tal:case case="string:TextInput" define="ko string:value:$name, disable:$name.disabled">
              ${structure: field(class_='form-control', **{'data-bind': ko})}
            </tal:case>
            <tal:case case="string:HiddenInput" define="ko string:value:$name, disable:$name.disabled">
              ${structure: field(**{'data-bind': ko})}
            </tal:case>
            <tal:case case="default">${structure: field()}</tal:case>
          </tal:switch>
        </tal:case>
      </tal:switch>
    </tal:widget>
  </metal:macro>

</metal:wtforms>
