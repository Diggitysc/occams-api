<!DOCTYPE html>
<html metal:use-macro="load:../master.pt" tal:define="wtforms load:../wtforms.pt">

  <metal:content-slot fill-slot="content-slot">

    <header class="page-header">
      <div class="pull-right">
        <div id="form-list-toolbar">
          <div class="btn-toolbar" role="toolbar" >
            <div class="btn-group">
              <button data-target="${request.route_path('form_add')}"
                  class="btn btn-default"
                  disabled
                  tal:condition="request.has_permission('form_add')"
                  data-bind="disable: !isReady(), click: startUploader">
                <span class="glyphicon glyphicon-upload"></span>
                <span i18n:translate="">Upload</span>
                <span style="display: none" data-bind="visible: isUploading" class="fa fa-refresh fa-spin"></span>
              </button>
              <button
                  data-target="${request.route_path('form_add')}"
                  class="btn btn-default"
                  disabled
                  tal:condition="request.has_permission('form_add')"
                  data-bind="disable: !isReady(), click: startEditor">
                <span class="glyphicon glyphicon-plus"></span>
                <span i18n:translate="">Create</span>
              </button>
            </div>
          </div> <!-- /.btn-toolbar -->
        </div>
      </div>
      <h1 i18n:translate="">Forms</h1>
    </header>

    <div class="alert alert-success"
          tal:repeat="msg request.session.pop_flash()">
      ${msg}
    </div>

    <!-- ko ifnot:isReady -->
      <p class="text-center" i18n:translate="">
        <span class="fa fa-refresh fa-spin"></span> Loading...
      </p>
    <!-- /ko -->

    <div style="display: none" data-bind="visible:isReady">

      <!-- ko ifnot:forms -->
        <p class="well well-lg" i18n:translate="">
          No forms have been created yet.
        </p>
      <!-- /ko -->

      <!-- ko if:forms -->
        <div class="clearfix">
          <div class="pull-left">
            <p>
              <span>Showing</span>
              <strong>
                <!-- ko if:filter -->
                  <span data-bind="text:filteredForms().length"></span>
                  <span>of</span>
                <!-- /ko -->
                <span data-bind="text:forms().length"></span>
              </strong>
              <span>forms</span>
            </p>
          </div>
          <div class="pull-right">
            <form>
              <div class="form-group">
                <input
                    type="search"
                    class="form-control"
                    name="filter"
                    placeholder="Filter forms..."
                    data-bind="
                      value: filter,
                      valueUpdate: ['input', 'afterkeydown']
                    "/>
              </div>
            </form>
          </div>
        </div>

        <div class="table-responsive">
          <table id="forms" class="table table-striped table-hover">
            <thead>
              <tr>
                <th class="has_private">
                  <span class="glyphicon glyphicon-user"></span>
                </th>
                <th class="name">Schema</th>
                <th class="title">Form</th>
                <th class="publish_date">Version</th>
              </tr>
            </thead>
            <tbody data-bind="foreach:filteredForms">
              <tr data-bind="
                  css: {'success': $data === $root.lastUpdatedForm()},
                  scrollToIf: $data === $root.lastUpdatedForm()">
                <td class="has_private" data-bind="if:has_private">
                  <span
                      class="glyphicon glyphicon-user"
                      title="Has private information"></span>
                </td>
                <td class="name"><div class="name-overflow"><code data-bind="text:name"></code></div></td>
                <td class="title" data-bind="text:title"></td>
                <td class="publish_date" data-bind="if:versions">
                  <table class="versions" data-bind="foreach: versions">
                    <tr>
                      <td>
                        <!-- ko if:publish_date -->
                         <a href="" data-bind="
                            attr: {href: __src__},
                            css: {is_retracted: retract_date},
                            text: publish_date"></a>
                        <!-- /ko -->
                        <!-- ko ifnot:publish_date -->
                          <a href="" data-bind="attr: {href: __src__}" i18n:translate="">Draft</a>
                        <!-- /ko -->
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      <!-- /ko -->
    </div>

    <div class="modal fade" data-keyboard="false" data-bind="showModal: selectedForm, with: selectedForm">
      <div class="modal-dialog">
        <div class="modal-content">
          <form data-bind="submit: $root.doSave">
            <div class="modal-header">
              <button type="button" class="close" aria-hidden="true" data-bind="click: $root.clearSelected">&times;</button>
              <h4 class="modal-title" i18n:translate="">Add New Form</h4>
            </div>
            <div class="modal-body">
              <metal:fields tal:define="form add_form" use-macro="wtforms.fields" />
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-link" data-bind="click: $root.clearSelected" i18n:translate="">Cancel</button>
              <button type="submit" class="btn btn-primary" data-bind="disable: $root.isSaving">
                <span i18n:translate="">Create</span>
                <span class="fa fa-refresh fa-spin" style="display: none" data-bind="visible: $root.isSaving"></span>
              </button>
            </div>
          </form>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->


  </metal:content-slot>

</html>

