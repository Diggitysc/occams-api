<div id="occams-form-editor">
      
  <metal:form metal:use-macro="context/@@ploneform-macros/form">
  
    <metal:title-slot metal:fill-slot="title">
      <div class="occams-form-title">
        <input type="textline" name="title" value="" tal:attributes="value context/item/title"/>
      </div>
    </metal:title-slot>
    
    <metal:description-slot metal:fill-slot="description">
      <div class="occams-form-description">
        <textarea name="description" tal:content="context/item/description"/>
      </div>
    </metal:description-slot>
    
    <metal:formtop-slot metal:fill-slot="formtop">
      <div id="occams-form-sidebar">
        <!-- TODO: version selector -->
          
        <!-- Field types -->
        <div id="occams-form-types">
          <h3>Supported Types</h3>
          <ul>
            <tal:block tal:repeat="type_ view/types">
              <li class="" tal:attributes="class type_/token" tal:content="type_/title">Type</li>
            </tal:block>
          </ul>
        </div>
      </div>
    </metal:formtop-slot>
    
    <metal:fields-slot metal:fill-slot="fields">
      <div id="occams-form-container">
        <!-- The form's fields -->
        <div id="occams-form-default-fieldset">
          <div class="occams-form-fields">
            <tal:widgets repeat="widget view/widgets/values">
              <div class="occams-form-field">
                <tal:block define="
                    edit_url      python: view.editUrl(widget.field);
                    delete_url    python: view.deleteUrl(widget.field);
                    title         widget/field/__name__;
                    type_         python: view.fieldType(widget.field);
                    version       python: view.fieldVersion(widget.field);
                    ">
                  <div class="occams-form-metadata">
                    <div class="" tal:attributes="class string: occams-form-title ${type_}" tal:content="title">Title</div>
                    <div class="occams-form-version" tal:content="version">Version</div>
                    <div class="occams-form-controls">
                      <ul>
                        <li><a href="" class="occams-form-edit" tal:attributes="href edit_url">Edit</a></li>
                        <li><a href="" class="occams-form-delete" tal:attributes="href delete_url">Delete</a></li>
                      </ul>
                    </div>
                  </div>
                </tal:block>
                <div class="occams-form-widget">
                  <tal:widget tal:replace="structure widget/@@ploneform-render-widget"/>
                </div>
              </div>                    
            </tal:widgets>
          </div>        
        </div>
        <!-- The form's fieldsets -->
        <div id="occams-form-fieldsets">
          <tal:block tal:repeat="group groups">
            <div class="occams-form-fieldset">
              <tal:block 
                  define="
                      edit_url      python: view.editUrl(group);
                      delete_url    python: view.deleteUrl(group);
                      title         string: ${group/label} (${group/prefix});
                      type_         python: view.fieldType(group);
                      version       python: view.fieldVersion(group);
                  ">
                  <div class="occams-form-metadata">
                    <div class="" tal:attributes="class string: occams-form-title ${type_}" tal:content="title">Title</div>
                    <div class="occams-form-version" tal:content="version">Version</div>
                    <div class="occams-form-controls">
                      <ul>
                        <li><a href="" class="occams-form-edit" tal:attributes="href edit_url">Edit</a></li>
                        <li><a href="" class="occams-form-delete" tal:attributes="href delete_url">Delete</a></li>
                      </ul>
                    </div>
                  </div>
              </tal:block>
              <div 
                  class="occams-form-element-description"
                  tal:define="group_description group/description|nothing"
                  tal:condition="group_description"
                  tal:content="structure group_description">
                Description
              </div>
              <div class="occams-form-fields">
                <tal:widgets repeat="widget group/widgets/values">
                  <div class="occams-form-field">
                    <tal:block define="
                          edit_url      python: view.editUrl(widget.field);
                          delete_url    python: view.deleteUrl(widget.field);
                          title         widget/field/__name__;
                          type_         python: view.fieldType(widget.field);
                          version       python: view.fieldVersion(widget.field);
                        ">
                      <div class="occams-form-metadata">
                        <div class="" tal:attributes="class string: occams-form-title ${type_}" tal:content="title">Title</div>
                        <div class="occams-form-version" tal:content="version">Version</div>
                        <div class="occams-form-controls">
                          <ul>
                            <li><a href="" class="occams-form-edit" tal:attributes="href edit_url">Edit</a></li>
                            <li><a href="" class="occams-form-delete" tal:attributes="href delete_url">Delete</a></li>
                          </ul>
                        </div>
                      </div>
                    </tal:block>
                    <div class="occams-form-widget">
                      <tal:widget tal:replace="structure widget/@@ploneform-render-widget"/>
                    </div>
                  </div>                    
                </tal:widgets>
              </div>
            </div>
          </tal:block>
        </div>
      </div>
    </metal:fields-slot>
    
  </metal:form>
</div>