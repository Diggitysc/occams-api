<html i18n:domain="occams.clinical" metal:use-macro="main_template">
  <metal:content-slot fill-slot="content-slot">

    <p class="lead" tal:condition="duration" i18n:translate="">
      Download your data. All your data are available for <strong>${duration}</strong>
    </p>

    <div class="well well-lg" tal:condition="not:exports_count" i18n:translate="">
      You have no exports pending.
    </div>

    <div
        class=""
        tal:condition="exports_count"
        tal:repeat="export exports"
        tal:attributes="
          id    string:export-${export.id};
          class string:panel panel-${'success' if export.status == 'complete' else 'default'};">

      <div class="panel-heading">
        <h3 class="panel-title">
          <strong class="status pull-right" tal:switch="export.status == 'complete'">
            <span tal:case="False" tal:omit-tag="" i18n:translate="">Generating...</span>
            <span tal:case="True" tal:omit-tag="" i18n:translate="">Complete</span>
          </strong>
          <a class="accordion-toggle"
              data-toggle="collapse"
              href="#export-collapse-${export.id}"
              ><span class="text-muted">Created on:</span> ${export.create_date.isoformat()}</a>
        </h3>
      </div> <!-- panel-heading -->

      <div class="panel-body" tal:condition="not:export.status == 'complete'">
        <div class="progress">
          <div
              class="progress-bar"
              role="progressbar"
              aria-valuenow="0"
              aria-valuemin="0"
              aria-valuemax="100">
            <span class="sr-only"></span>
          </div>
        </div>
      </div> <!-- panel-body -->

      <div id="export-collapse-${export.id}" class="panel-collapse collapse">
        <table class="table table-bordered table-condensed">
          <thead>
            <tr>
              <th class="name" i18n:translate="">Name</th>
              <th class="title" i18n:translate="">Title</th>
              <th class="publsished" i18n:translate="">Published</th>
            </tr>
          </thead>
          <tbody>
            <tr tal:repeat="schema export.schemata">
              <td class="name">${schema.name}</td>
              <td class="title">${schema.title}</td>
              <td class="published">${schema.publish_date.isoformat()}</td>
            </tr>
          </tbody>
        </table>
      </div> <!-- /panel-collapse -->

      <div class="panel-footer clearfix">
          <a class="btn btn-primary pull-right ${'disabled' if export.status != 'complete' else ''}"
              href="${request.route_path('data_download', export_id=export.id)}"
              target="_blank"
              i18n:translate="">Download</a>
          <span class="text-muted" i18n:translate="">Available until:</span>
          <strong tal:define="timedelta import: datetime.timedelta">${(export.create_date + timedelta(7)).isoformat()}</strong>
      </div>

    </div> <!-- /panel-footer -->

  </metal:content-slot>
</html>
