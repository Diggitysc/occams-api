<html i18n:domain="occams.clinical" metal:use-macro="main_template">
  <metal:content-slot fill-slot="content-slot">

    <div class="alert alert-danger" tal:condition="form.error|nothing">
    <strong>Error!</strong> Your request failed for the following reasons:
      <ul>
        <li tal:repeat="error form.error.children">${error.msg}</li>
      </ul>
    </div>

    <form
        role="form"
        name="export"
        method="POST"
        action="${request.current_route_path()}">

      <h3>Step 1</h3>

      <p class="lead">${structure:form['schemata'].title}</p>

      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th class="select">
                <input type="checkbox" data-toggle="selectall" />
              </th>
              <th class="has_private">
                <span class="glyphicon glyphicon-user"></span>
              </th>
              <th class="title" i18n:translate="">Title</th>
              <th class="name" i18n:translate="">Name</th>
              <th class="version" i18n:translate="">Version</th>
            </tr>
          </thead>
          <tbody>
            <tr tal:repeat="schema schemata">
              <td class="select">
                <input
                    type="checkbox"
                    name="schemata"
                    value="${schema.name}"
                    data-toggle="select"
                    data-class="warning" />
              </td>
              <td>
                <span
                    class="glyphicon glyphicon-user"
                    title="Has private information"
                    tal:condition="schema.has_private"></span>
              </td>
              <td class="title">${schema.title}</td>
              <td class="name"><code>${schema.name}</code></td>
              <td class="version">
                <p tal:repeat="version versions[schema.name]">${version.isoformat()}</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <hr />

      <h3>Step 2</h3>

      <p class="lead">${structure:form['expand_collections'].title}</p>

      ${structure:form['expand_collections'].serialize()}

      <hr/>

      <h3>Step 3</h3>

      <p class="lead">${structure:form['use_choice_labels'].title}</p>

      ${structure:form['use_choice_labels'].serialize()}

      ${structure:form['csrf_token'].serialize()}

      <hr />

      <p>
        <button
            type="submit"
            name="submit"
            class="pull-right btn btn-lg btn-primary"
            tal:attributes="disabled exceeded"
            i18n:translate="">Export</button>
      </p>

    </form>

  </metal:content-slot>
</html>
