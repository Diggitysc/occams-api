<nav
    class="navbar navbar-default navbar-static-top"
    role="navigation"
    i18n:domain="occams.clinical"
    tal:define="user request.user|nothing;">

  <div class="container">

    <div class="navbar-header">
      <button
          type="button"
          class="navbar-toggle"
          data-toggle="collapse"
          data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand"
          href="${request.route_path('clinical')}">Clinical</a>
    </div> <!--/.navbar-header -->

    <div class="collapse navbar-collapse">

      <ul class="nav navbar-nav"
          tal:define="section request.current_route_path()">
        <li tal:define="url request.route_path('clinical')"
            tal:attributes="class python:'active' if url == section else ''"
            tal:condition="request.has_permission('view')">
          <a href="${url}">Home</a>
        </li>
        <li tal:define="url request.route_path('study_list')"
            tal:attributes="class python:'active' if url in section else ''"
            tal:condition="request.has_permission('study_view')">
          <a href="${url}">Studies</a>
        </li>
        <li tal:define="url request.route_path('data_list')"
            tal:attributes="class python:'active' if url in section else ''"
            tal:condition="request.has_permission('fia_view')">
          <a href="${url}">Data</a>
        </li>
      </ul>

      <form class="navbar-form navbar-left" role="search"
          method="GET"
          action="${request.route_path('patient_search')}"
          tal:condition="request.has_permission('patient_view')">
        <div class="form-group">
          <label class="sr-only" for="search">Search</label>
          <input
              type="text"
              class="form-control"
              name="search"
              value="${request.GET['search']|nothing}"
              placeholder="Search for Patient">
        </div>
        <button type="submit" class="btn btn-default"
          ><span class="glyphicon glyphicon-search"></span></button>
      </form>

      <button
          id="event-add"
          data-toggle="modal"
          data-target="#modal"
          data-remote="${request.route_path('event_add')}"
          class="btn btn-primary navbar-btn navbar-left js-modal-controller"
          tal:condition="request.has_permission('visit_add')"
        ><span class="glyphicon glyphicon-plus-sign"></span> Add Event</button>

      <ul class="nav navbar-nav navbar-right"
          tal:define="user request.environ['repoze.who.identity']['properties']|nothing;"
            tal:condition="user">
        <li><a href="${request.route_path('account')}" class="disabled"
          >${user['first_name']}</a></li>
        <li class="dropdown"
            tal:condition="request.apps">
          <a href="#apps"
            role="button"
            class="dropdown-toggle"
            rel="tooltip"
            data-toggle="dropdown"
            data-placement="bottom"
            data-container="body"
            data-animation="false"
            title="Services"
            ><span class="glyphicon glyphicon-th"></span><span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="Apps Menu">
            <tal:suites repeat="suite request.apps">
              <li role="presentation" class="dropdown-header">
                ${suite['title']}
              </li>
              <tal:apps repeat="app suite['apps']">
                <li role="presentation">
                  <a href="${app['url']}" role="menuitem">${app['title']}</a>
                </li>
              </tal:apps>
              <li role="presentation" class="divider"
                  tal:condition="not:repeat.suite.end"></li>
            </tal:suites>
          </ul>
        <li>
          <a href="${request.route_path('account_logout')}"
              rel="tooltip"
              data-placement="bottom"
              data-container="body"
              data-animation="false"
              title="Log Out"
            ><span class="glyphicon glyphicon-log-out"></span></a>
        </li>
      </ul>

    </div><!--/.nav-collapse -->

  </div>
</nav>
